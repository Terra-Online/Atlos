@use '../../styles/palette.scss' as *;
@use '../../styles/curves.scss' as *;
@use 'sass:color';
@use 'sass:math';

:root, :root[data-theme='light'] {
    --regswitch-bg: #{rgba($white-2, 0.25)};
    --regswitch-item: #{$grey-1};
    --regswitch-item-hover: #{$grey-2};
    --regswitch-selected: #{$primary-accent-4};
    --regswitch-icon-on: #{$grey-1};
    --regswitch-icon-off: #{$white-1};
}
:root[data-theme='dark'] {
    --regswitch-bg: #{rgba($grey-2, 0.3)};
    --regswitch-item: #{$black-1};
    --regswitch-item-hover: #{$grey-1};
    --regswitch-selected: #{$primary-accent-4};
    --regswitch-icon-on: #{$black-1};
    --regswitch-icon-off: #{$light-2};
}

$transition-speed: 0.3s;
$item-height: 2.5rem;
$item-gap: 0.6rem;
$indicator-height: 0.75rem;

.regswitch {
    position: absolute;
    left: 1rem;
    top: 40%;
    display: flex;
    flex-direction: column;
    gap: $item-gap;
    background-color: var(--regswitch-bg);
    backdrop-filter: blur(8px);
    border-radius: 3px;
    padding: 5px;
    box-shadow: 0 0 5px rgba($black-0, 0.6);
    z-index: 900;
    transform: translateY(-50%);
    transition: transform 0.3s ease-in-out,
                background-color 0.35s $moderato-curve;
}

.indicator {
    position: absolute;
    left: 1.5px;
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 8px solid color.adjust($primary-accent-4, $lightness: -10%);
    transition:
        transform 0.4s $presto-curve,
        opacity 0.3s ease;
    z-index: 10;
    filter: drop-shadow(0 0 1px rgba($black-0, 0.8));
    transform: translateY(calc(-50% + 1.25rem));

    &.hidden {
        opacity: 0;
    }
}

.regItem {
    display: flex;
    align-items: center;
    justify-content: center;
    width: $item-height;
    height: $item-height;
    padding: 0.25rem;
    border-radius: 3px;
    background-color: var(--regswitch-item);
    box-shadow: 0 0 4px rgba($black-0, 0.6);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;

    &:hover {
    background-color: var(--regswitch-item-hover);
    box-shadow: 0 0 2px rgba($black-0, 0.75);
    }

    &.selected {
    background-color: var(--regswitch-selected);
    box-shadow: 0 0 4px rgba($black-0, 0.75);

        .icon svg {
            fill: var(--regswitch-icon-on);
        }
    }

    &.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;

        svg {
            transition: all 0.3s ease;
            fill: var(--regswitch-icon-off);
            width: 1.5rem;
            height: 1.5rem;
        }
    }

    &:hover {
        .subregionSwitchContainer {
            opacity: 1;
            transition:
                opacity 0.2s ease-in-out,
                visibility 0s;
            pointer-events: auto;
        }
    }
}

.subregionSwitchContainer {
    position: absolute;
    left: 100%;
    top: 50%;
    padding-left: 1rem;
    transform: translateY(-50%);
    transition: opacity 0.2s ease-in-out;
    pointer-events: none;
    opacity: 0;

    .subregionSwitch {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: $item-gap;
        background-color: var(--regswitch-bg);
        border-radius: 3px;
        padding: 5px;
        box-shadow: 0 0 5px rgba($black-0, 0.6);
        max-height: 300px;
        overflow-y: auto;
        backdrop-filter: blur(8px);
    }
}

// .subregswitch {
//   display: flex;
//   flex-direction: column;
//   gap: $item-gap;
//   background-color: rgba($white-2, 0.25);
//   border-radius: 3px;
//   padding: 5px;
//   box-shadow: 0 0 5px rgba($black-0, 0.6);
//   position: relative;
//   max-height: 300px;
//   overflow-y: auto;
//   margin-top: -150px;
//   transition: margin 0.3s ease;
// }

.subregItem {
    display: flex;
    align-items: center;
    justify-content: center;
    width: $item-height;
    height: $item-height;
    padding: 0.25rem;
    border-radius: 3px;
    background-color: var(--regswitch-item);
    box-shadow: 0 0 4px rgba($black-0, 0.6);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;

    // &::after {
    //   content: '';
    //   position: absolute;
    //   right: 0;
    //   bottom: 0;
    //   width: 0;
    //   height: 0;
    //   border-top: 0;
    //   border-bottom: 8px solid transparent;
    //   border-left: 8px solid color.adjust($primary-accent-4, $lightness: -10%);
    //   transition: opacity 0.4s $presto-curve;
    //   opacity: 0;
    //   z-index: 10;
    //   filter: drop-shadow(0 0 1px rgba($black-0, 0.8));
    // }

    &:hover {
        background-color: var(--regswitch-item-hover);
        box-shadow: 0 0 2px rgba($black-0, 0.75);
    }

    // &.selected {
    //   &::after {
    //     opacity: 1;
    //   }
    // }

    &.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .subregIcon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;

        .subregColorBlock {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 3px;
        }
    }
}

// SVG 动画样式
path.subregion-highlight-stroke {
    stroke: $primary-accent-4;
    stroke-width: 4;
    fill: none;
    filter: drop-shadow(0 0 8px rgba($primary-accent-4, 0.6));

    animation:
        drawStroke 1s ease-out forwards,
        holdStroke 1.5s 1s ease-out forwards,
        retractStroke 0.4s 1.5s ease-in forwards;
}

path.subregion-highlight-fill {
    fill: $primary-accent-1;
    fill-opacity: 0;
    stroke-width: 2;
    stroke: $primary-accent-3;
    animation: waitForStroke 1.5s ease-out forwards;
}

@keyframes drawStroke {
    0% {
        stroke: rgba($primary-accent-4, 0);
    }

    100% {
        stroke: rgba($primary-accent-4, 1);
    }
}

@keyframes holdStroke {
    0%,
    100% {
        stroke-dasharray: 0;
    }
}

@keyframes retractStroke {
    0% {
        stroke-dasharray: 0;
        stroke-dashoffset: 0;
    }

    100% {
        stroke-dasharray: 20, 10;
        stroke-dashoffset: 90;
        opacity: 0;
    }
}

@keyframes waitForStroke {
    0% {
        fill-opacity: 0;
        clip-path: polygon(0 0, 0 0, -25% 100%, -25% 100%);
    }

    50% {
        fill-opacity: 0.3;
        clip-path: polygon(0 0, 125% 0, 100% 100%, -25% 100%);
    }

    100% {
        fill-opacity: 0;
        clip-path: polygon(125% 0, 125% 0, 100% 100%, 100% 100%);
    }
}
