@use '../../../styles/palette.scss' as *;
@use '../../../styles/curves.scss' as *;

/* TODO: more point action include:
   1. next point highlight
   2. checked point indication √
   3. point pulse animation
   4. point click feedback √
   5. dark mode √
   6. point stuff posit √
*/

/* state injected on Inner */
/* fade-in/out (removed next frame) */
.markerInner {
    opacity: 1;
    transition: opacity 0.15s ease-in;
    position: relative;
    z-index: 1;
    &::before {
         content: '';
        position: absolute;
        width: var(--icon-size);
        height: var(--icon-size);
        background-color: $white-1;
        box-shadow: 0 0 10px $black-0;
        border-radius: 50%;
        z-index: -1;
        outline: 2px solid transparent;
        outline-offset: 12px;
        transform: translate3d(calc((var(--image-size) - var(--icon-size)) / 2), calc((var(--image-size) - var(--icon-size)) / 2), 0);

        transition: outline 0.35s $presto-curve, outline-offset 0.35s $presto-curve;
    }
    &:hover {
        &::before {
            outline: 2px solid rgba($white-1, 0.4);
            outline-offset: 8px;
            transition: outline 0.25s ease-in, outline-offset 0.25s ease-in;
        }
        .subIconContainer{
            &::before {
                transform: translate3d(-50%, -50%, 0) scale(1);
                opacity: 1;
                transition: transform 0.35s $presto-curve, opacity 0.35s $presto-curve;
            }
            .subIcon {
                transform: translate3d(-50%, -50%, 0) scale(1.05);
                transition: transform 0.35s $presto-curve;
            }
        }
    }
    &.selected {
        &::before {
            outline: 2px solid $white-1;
            outline-offset: 6px;
            transition: outline 0.125s $adagio-curve, outline-offset 0.125s $adagio-curve;
        }
        .FrameImage {
            opacity: 1;
            &::before {
                outline-color: $primary-accent-4;
            }
            &::after {
                border-top-color: $primary-accent-4;
            }
            &:has(+ .subIconContainer)::after {
                transform: rotate(-90deg);
            }
            &:not(:has(+ .subIconContainer))::after {
                bottom: -11px;
            }
        }
        
        .subIconContainer {
            &::before {
                transform: translate3d(-50%, -50%, 0) scale(1);
                opacity: 0;
                transition: transform 0.35s $presto-curve, opacity 0.35s $presto-curve;
            }
            &::after {
                transform: translate3d(-50%, -50%, 0) scale(1.05);
                opacity: 1;
                transition: transform 0.35s $presto-curve, opacity 0.35s $presto-curve;
            }
        }
    }
    &.checked {
        opacity: 0.3;
        z-index: 0; // 已完成的点位 z-index 更低，不会遮挡未完成的点位
        .FrameImage { 
            &::before {
                background-color: $primary-accent-4;
            }
        }
        .subIconContainer {
            opacity: 0.5;
        }
    }
}
.noFrameInner {
    opacity: 1;
    transition: opacity 0.15s ease-in, transform 0.3s $moderato-curve; // faster on reverse animation for visual unity
    position: relative;
    z-index: 1;
    &:hover {
        transform: translate3d(-50%, -60%, 0);
        transition: transform 0.35s $moderato-curve;
        z-index: 1000;
    }
    &.selected {
        .noFrameImage {
            opacity: 1;
            filter: invert(1);
            transition: filter 0.3s $standard-curve, opacity 0.3s $moderato-curve;
        }
    }
    &.checked {
        z-index: 0; // 已完成的点位 z-index 更低，不会遮挡未完成的点位
        .noFrameImage {
            opacity: 0.5;
        }
    }
}
.noFrameInner, .markerInner {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate3d(-50%, -50%, 0);
}

.noFrameMarkerIcon {
    background-color: transparent;
    .noFrameImage {
        display: block;
        width: 50px;
        height: 50px;
        object-fit: contain;
        transition: filter 0.3s $moderato-curve, opacity 0.3s $moderato-curve;
        opacity: 1;
        filter: invert(0);
    }
}
.markerInner.appearing,
.noFrameInner.appearing {
    animation: markerFadeIn 0.15s ease-out forwards;
}

@keyframes markerFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.markerInner.checked.appearing,
.noFrameInner.checked.appearing {
    animation: markerFadeInChecked 0.15s ease-out forwards;
}

@keyframes markerFadeInChecked {
    from {
        opacity: 0;
    }
    to {
        opacity: 0.3;
    }
}

.markerInner.disappearing,
.noFrameInner.disappearing {
    animation: markerFadeOut 0.15s ease-in forwards;
}

@keyframes markerFadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

.markerInner.checked.disappearing,
.noFrameInner.checked.disappearing {
    animation: markerFadeOutChecked 0.15s ease-in forwards;
}

@keyframes markerFadeOutChecked {
    from {
        opacity: 0.3;
    }
    to {
        opacity: 0;
    }
}

.FrameMarkerIcon {
    background-color: transparent;

    --image-size: 2rem;
    --icon-size: 1.75rem;
    .FrameImage {
        position: relative;
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        width: var(--image-size);
        height: var(--image-size);

        opacity: 1;
        transition: opacity 0.3s $moderato-curve;

        &::before {
            content: '';
            position: absolute;
            width: var(--icon-size);
            height: var(--icon-size);
            background-color: $white-1;
            box-shadow: 0 0 10px $black-0;
            border-radius: 50%;
            z-index: -1;
            outline: 2px solid $white-1;
            outline-offset: 2px;
            transform: translate3d(calc((var(--image-size) - var(--icon-size)) / 2), calc((var(--image-size) - var(--icon-size)) / 2), 0);

            transition: outline-color 0.15s $moderato-curve, background-color 0.15s $moderato-curve;
        }
        &::after {
            content: '';
            position: absolute;
            bottom: -9px;
            left: calc(50% - 5px);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 7px solid $white-1;
            transition: transform 0.2s $presto-curve;
            z-index: 10;
            filter: drop-shadow(0 0 2px rgba($black-0, 0.7));
            -webkit-transform-origin-x: center;
            -webkit-transform-origin-y: calc(calc(var(--image-size) + 4px) / -2);

            transition: border-top-color 0.1s $adagio-curve, transform 0.3s $presto-curve, bottom .15s $adagio-curve;
        }
    }
}

.subIconContainer {
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    width: 2.5rem;
    height: 2.5rem;
    pointer-events: none;
    z-index: 1;

    transition: opacity 0.15s ease-in;
    &::before {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate3d(-50%, -50%, 0) scale(1.2);
        width: 30px;
        height: 30px;
        z-index: -1;
        background-image: url('../../../assets/images/UI/marker-hover.webp');
        background-position: center;
        background-size: contain;

        opacity: 0;
        transition: transform 0.5s $presto-curve, opacity 0.5s $presto-curve;
    }
    
    &::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate3d(-50%, -50%, 0) scale(1.2);// 25 * 1.2 = 30 = ::before size
        width: 25px;
        height: 25px;
        z-index: -2;
        background-image: url('../../../assets/images/UI/marker-select.webp');
        background-position: center;
        background-size: contain;

        opacity: 0;
        transition: transform 0.35s $presto-curve, opacity 0.35s $presto-curve;
    }
    .subIcon {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate3d(-50%, -50%, 0);
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: contain;
        background-repeat: no-repeat;
        transition: transform 0.35s $presto-curve, opacity 0.35s $presto-curve;
        will-change: transform, opacity;   

    }
}

.clusterMarker {
    position: relative;  
    .clusterCount {
        position: absolute;
        top: -0.5rem;
        right: -0.5rem;
        background-color: $primary-accent-4;
        color: $grey-1;
        font-family: 'Novecento Medium', sans-serif;
        font-size: 0.75rem;
        font-weight: 700;
        min-width: 18px;
        height: 18px;
        border-radius: 9px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 4px;
        box-shadow: -1px 1px 2px rgba($black-0, 0.8);
        z-index: 10;
        pointer-events: none;
    }

    &:hover {
        &::before {
            outline: 2px solid rgba($white-1, 0.6);
            outline-offset: 10px;
            transition: outline 0.25s ease-in, outline-offset 0.25s ease-in;
        }
    }
}

.noFrameInner.clusterMarker {
    .clusterCount {
        top: 2px;
        right: 2px;
        background-color: rgba($primary-accent-4, 0.9);
        backdrop-filter: blur(4px);
    }
    
    &:hover {
        transform: translate3d(-50%, -55%, 0);
        transition: transform 0.35s $moderato-curve;
    }
}